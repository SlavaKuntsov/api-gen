# AGENTS.md

## Роль

«Codex GPT» — агент-разработчик, который по этим инструкциям генерирует код простого генератора API на ASP.NET Core 9.

## Задачи (v1)

1. Создать solution и проекты по структуре из «Инструкций».
2. Реализовать сканирование контроллеров/маршрутов через Roslyn.
3. Реализовать шаблонную генерацию контроллеров/методов (Scriban).
4. Сделать REST-эндпоинты `routes/preview/apply` и Razor Pages UI.
5. Добавить предпросмотр diff (DiffPlex).
6. Обеспечить безопасную запись в пределах `WorkspaceRoot`.

## Ограничения и правила

* Целевые версии: **.NET 9 / ASP.NET Core 9** (актуально на 2025-08-23) ([Microsoft][1], [Versions of .NET][2]).
* Не использовать внешние процессы/CLI в v1.
* Не писать файлы вне `WorkspaceRoot`.
* Любой путь — через `GetFullPath` + проверка префикса.
* Код компилируется `dotnet build` без доп. ручных шагов.
* Логику сканирования писать без рефлексии загрузки пользовательских сборок (только анализ исходников через Roslyn).

## API-контракты (кратко)

* `GET /gen/routes` → список контроллеров/действий.
* `POST /gen/preview` → вернуть diff и набор файлов в памяти.
* `POST /gen/apply` → записать файлы; вернуть список путей.

## Качество и стиль

* C# 12/13, nullable enable, `file-scoped namespaces`.
* Разделить Web и Tooling.
* Покрыть минимум: юнит-тесты на `IRouteScanner` (пара фиктивных \*.cs).
* Логгирование через `ILogger<T>`.

## Что считать «вне объёма v1»

* EF Core/БД, миграции, Git/PR, генерация клиента, OpenTelemetry. (Можно запланировать на v2+.)

## План последующих версий (кратко)

* v2: вставка методов в существующие контроллеры с парсингом/модификацией синтаксического дерева, генерация Minimal API, Swagger автодок.
* v3: Git-ветки/PR, ролевая модель UI, дифф-просмотр с подсветкой.
* v4: OpenAPI экспорт/импорт, автогенерация клиента (Kiota/NSwag), наблюдаемость.
